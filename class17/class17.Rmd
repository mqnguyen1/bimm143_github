---
title: "class17"
author: "Matthew"
date: "3/7/2023"
output: github_document
---

```{r}
vax <- read.csv("covid19vaccinesbyzipcode_test.csv")
head(vax)
```

# Q1. What column details the total number of people fully vaccinated? 

```{r}
head(vax$persons_fully_vaccinated)
```


Column 10 (called persons_fully_vaccinated)


# Q2. What column details the Zip code tabulation area? 

```{r}
head(vax$zip_code_tabulation_area)
```


Column 2 (called zip_code_tabulation_area)

# Q3. What is the earliest date in this dataset? 

```{r}
vax$as_of_date[1]
```


2021-01-05

# Q4. What is the latest date in this dataset? 

```{r}
vax$as_of_date[nrow(vax)]
```


```{r}
tail(vax)
```

2023-02-28



```{r}
skimr::skim(vax)
```


# Q5. How many numeric columns are in this dataset? 

13


# Q6. Note that there are “missing values” in the dataset. How many NA values there in the persons_fully_vaccinated column? 

```{r}
n.missing <- sum(is.na(vax$persons_fully_vaccinated))
n.missing
```


# Q7. What percent of persons_fully_vaccinated values are missing (to 2 significant figures)?

```{r}
sum(is.na(vax$persons_fully_vaccinated))/length(vax$persons_fully_vaccinated)

```
```{r}
round((n.missing/nrow(vax))*100,2)
```
8.29% 

# Working with dates

The lubridate packages makes working with dates and times in R much less of a pain, let's have a first play with this package here. 

```{r}
library(lubridate)
```

```{r}
today()
today() - ymd("2000-10-10")
```

We can now magically do math with dates 

```{r}
# Specify that we are using the year-month-day format
vax$as_of_date <- ymd(vax$as_of_date)
```


How many days have passed since the first vaccination reported in this dataset?

```{r}
today() - vax$as_of_date[1]
```

How many days does the dataset span? 

```{r}
vax$as_of_date[nrow(vax)] - vax$as_of_date[1]
```

# Q9. How many days have passed since the last update of the dataset? 

```{r}
today()-ymd("2023-02-28")
today()-vax$as_of_date[nrow(vax)]
```

7 days 

# Q10. How many unique dates are in the dataset (i.e. how many different dates are detailed)?

```{r}
length(unique(vax$as_of_date))
```

113 unique dates 

# Working with ZIP codes 

ZIP codes are also rather annoying things to work with as they are numeric but they are not in the conventional sense of doing math

Just like dates we have special packages to help us work with ZIP codes. 
```{r}
library(zipcodeR)
```


```{r}
geocode_zip('92037')
```

Calculate the distance between the centroids of any two ZIP codes in miles, e.g.

```{r}
zip_distance('92037','92109')
```


```{r}
reverse_zipcode(c('92037', "92109") )
```

```{r}
reverse_zipcode('92618')
```

# Focus on the San Diego area

Let’s now focus in on the San Diego County area by restricting ourselves first to vax$county == "San Diego" entries. We have two main choices on how to do this. The first using base R the second using the dplyr package:


```{r}
sd <- vax[ vax$county == "San Diego" , ]
nrow(sd)
```

It is time to revisit  **dplyr** package. 

```{r}
library(dplyr)
```

```{r}
sd <- filter(vax, county == "San Diego")

nrow(sd)
```

```{r}
sd.10 <- filter(vax, county == "San Diego" &
                age5_plus_population > 10000)
head(sd.10)
```


# Q11. How many distinct zip codes are listed for San Diego County?
```{r}
length(unique(sd.10$zip_code_tabulation_area))
```
```{r}
n_distinct(sd.10$zip_code_tabulation_area)
```


There are 76 distinct zip codes 

# Q12. What San Diego County Zip code area has the largest 12 + Population in this dataset?

```{r}
max(sd.10$age12_plus_population)
```

```{r}
head(sd.10%>%arrange(desc(age12_plus_population)))
```

The zip code with the largest 12+ population is 92154



# Q13. What is the overall average “Percent of Population Fully Vaccinated” value for all San Diego “County” as of “2023-02-28”? 


```{r}
sd.today <- filter(sd,as_of_date=="2023-02-28")
```

```{r}
mean(sd.today$percent_of_population_fully_vaccinated,na.rm = T)
```

74.01% 


# Q14. Using either ggplot or base R graphics make a summary figure that shows the distribution of Percent of Population Fully Vaccinated values as of “2023-02-28”?

```{r}
library(ggplot2)
```

```{r}
hist(sd.today$percent_of_population_fully_vaccinated)
```

```{r}
ucsd <- filter(sd, zip_code_tabulation_area=="92037")
ucsd[1,]$age5_plus_population
```


# Q15. Using ggplot make a graph of the vaccination rate time course for the 92037 ZIP code area:
```{r}
ggplot(ucsd) +
  aes(as_of_date,
      percent_of_population_fully_vaccinated) +
  geom_point() +
  geom_line(group=1) +
  ylim(c(0,1)) +
  labs(x="date", y="Percent Vaccinated")
```

```{r}
# Subset to all CA areas with a population as large as 92037
vax.36 <- filter(vax, age5_plus_population > 36144 &
                as_of_date == "2023-02-28")

head(vax.36)
```
# Q16. Calculate the mean “Percent of Population Fully Vaccinated” for ZIP code areas with a population as large as 92037 (La Jolla) as_of_date “2022-11-15”. Add this as a straight horizontal line to your plot from above with the geom_hline() function?

```{r}
mean(vax.36$percent_of_population_fully_vaccinated)
```
The mean percent of population vully vaccinated is 72.13% 

```{r}
ggplot(ucsd) +
  aes(as_of_date,
      percent_of_population_fully_vaccinated) +
  geom_point() +
  geom_line(group=1) +
  ylim(c(0,1)) +
  labs(x="date", y="Percent Vaccinated")+
  geom_hline(yintercept = mean(vax.36$percent_of_population_fully_vaccinated),linetype=2,color="red")
```

# Q17. What is the 6 number summary (Min, 1st Qu., Median, Mean, 3rd Qu., and Max) of the “Percent of Population Fully Vaccinated” values for ZIP code areas with a population as large as 92037 (La Jolla) as_of_date “2022-11-15”?

```{r}
summary(vax.36$percent_of_population_fully_vaccinated)
```

The min, 1st quartile, median, mean, 3rd quartile, and max are 38.04%, 64.57%, 72.13%, 79.07%, and 100% respectively. 

# Q18. Using ggplot generate a histogram of this data.

```{r}
ggplot(vax.36,
       aes(percent_of_population_fully_vaccinated))+
  geom_histogram()+
  xlim(0,1)
```


# Q19. Is the 92109 and 92040 ZIP code areas above or below the average value you calculated for all these above?

```{r}
x <- filter(vax.36,zip_code_tabulation_area %in% c("92109","92040"))
x$percent_of_population_fully_vaccinated
```

Both are below the avearge value of the mean we calculated above. 


# Q20. Finally make a time course plot of vaccination progress for all areas in the full dataset with a age5_plus_population > 36144.

```{r}
vax.36.all <- filter(vax,age5_plus_population > 36144 )


ggplot(vax.36.all) +
  aes(as_of_date,
      percent_of_population_fully_vaccinated, 
      group=zip_code_tabulation_area) +
  geom_line(alpha=0.2, color="blue") +
  ylim(0,1) +
  labs(x="date", y="percent vaccinated",
       title="Vaccination rate across California",
       subtitle="Only areas with a population above 36k are shown") +
  geom_hline(yintercept = mean(vax.36$percent_of_population_fully_vaccinated), linetype=2)
```


